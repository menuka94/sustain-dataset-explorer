<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.control.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
    <script src="https://unpkg.com/jeezy@1.12.11/lib/jeezy.min.js"></script>
    <script src="https://unpkg.com/data2grid@1.0.0/build/data2grid.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/nezasa/iso8601-js-period/master/iso8601.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.min.js"></script>
    <script type="text/javascript" src="Dependencies/moment.js"></script>
    <script type="text/javascript" src="../geohash_util.js"></script>
    <script type="text/javascript" src="Dependencies/Sketch_Visualization/grpc_querier.bundle.js"></script>
    <script type="text/javascript" src="Dependencies/Sketch_Visualization/sketch_visualizer.js"></script>
    <link rel="stylesheet" type="text/css" href="IframeStyle.css">
</head>
<body>
    <!--Required for this map to be controlled-->
    <script>const MAPNUMBER = 1; //refers to whatever map in the grid this refers to</script>
    <script src="Dependencies/mouseDown.js"></script>
    <script>thisMapNumber=MAPNUMBER; //changes a variable in the mouseDown.js script</script>
    <!------------------------------------------>

    <script src="Dependencies/time-dimension.js"></script>
    <div id='map1' class='map'></div>

    <script>
        const mymap = L.map('map1', {renderer: L.canvas(), minZoom: 3,
            fullscreenControl: true,
            timeDimension: true,
            inertia: false,
			timeDimensionOptions: {
        		    timeInterval: "2015-01-02T06:00:00Z/2015-01-31T18:00:00Z",
        		    transitionTime: 10,
        		    period: "PT6H",
                    currentTime: new Date("2015-01-01T00:00:00Z")},
			}
        );

        mymap.on("load", function () {
            //when loading is done
        });

        mymap.setView(mymap.wrapLatLng(window.parent.view), window.parent.zoomLevel);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 8,
                id: 'mapbox.streets',
                accessToken: 'pk.eyJ1Ijoia2V2aW5icnVod2lsZXIiLCJhIjoiY2ptdjBuMzRiMGNzeTNwbm9sYml5aWhvcyJ9.i6hZMqiVZgDiyDj5zcFcIA',
            maxBounds: [[],[]]
        }).addTo(mymap);

        td = L.timeDimension.layer.CustomTimeDimension({}, sketch_visualizer({
            0.0: [0, 0, 255],
            0.5: [0, 255, 0],
            1.0: [255, 0, 0]
        }));

        L.Control.TimeDimensionCustom = L.Control.TimeDimension.extend({
            _getDisplayDateFormat: function(date){
                return moment.utc(date).format('HH:mm - MM/DD/YYYY (UTC)');
            }
        });

        const timeDimensionControl = new L.Control.TimeDimensionCustom({
            autoPlay: false,
            maxSpeed: .5,
        });

        mymap.addControl(timeDimensionControl);
        td.addControlReference(timeDimensionControl);
        td.addTo(mymap);

        mymap.on("move", function () {
            parent.setGlobalPosition(mymap.getCenter(),MAPNUMBER);
        });
        mymap.on("zoomend", function () {
            parent.setGlobalPositionFORCE(mymap.getCenter(),MAPNUMBER);
        });
    </script>

    <!--You must add this map's setter function-->
    <script>
        var thisMapsSetter = function(view,zoom){
            mymap.setView(mymap.wrapLatLng(view), mymap.getZoom());
        }
        parent.setterFunctions.push({
            setterFunc: thisMapsSetter,
            mapNum: MAPNUMBER
        });
    </script>
</body>
